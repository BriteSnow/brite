var brite=brite||{};brite.version="0.9-snapshot";(function(d){var c={};var k={};var l={};var g={};brite.registerComponent=function(s,r,u){var t={};t.name=s;t.componentFactory=u;t.config=d.extend({},this.defaultComponentConfig,r);c[s]=t;var q=l[s];if(q){q.resolve(t);delete l[s]}};brite.instantiateComponent=function(q){var r=e(q);return j(componentDef)};brite.registerTransition=function(q,r){g[q]=r};brite.getTransition=function(q){return g[q]};brite.display=function(q,s,r){return a(q,s,r)};brite.attach=function(r,q,t,s){return a(r,t,s,q)};brite.config={componentsHTMLHolder:"body",tmplPath:"tmpl/",tmplExt:".tmpl"};brite.defaultComponentConfig={loadTmpl:false,loadCss:false,emptyParent:false,postDisplayDelay:0};function e(q){var s=d.Deferred();var r=i(q);r.done(function(B){var x,y;var t=B.config.loadTmpl;if(t&&!k[q]){var w=true;var D=B.config.checkTemplate;if(D){var A=(typeof D=="string")?D:("#tmpl-"+q);if(d(A).length>0){w=false}}if(w){x=d.Deferred();var C=(typeof t=="string")?C:(q+".html");d.ajax({url:brite.config.tmplPath+q+brite.config.tmplExt,async:true}).complete(function(E,F){d(brite.config.componentsHTMLHolder).append(E.responseText);k[q]=true;x.resolve()})}}var z=brite.defaultComponentConfig.loadCss;if(z){y=d.Deferred();var u="css/"+q+".css";var v=b(u,"css");v.done(function(){y.resolve()}).fail(function(){console.log("Brite ERROR: cannot load "+u+". Ignoring issue");y.resolve()})}d.when(x,y).done(function(){s.resolve(B)})});r.fail(function(){console.log("BRITE-ERROR: Brite cannot load component: "+q)});return s.promise()}function i(r){var q=d.Deferred();var t=c[r];if(t){q.resolve(t)}else{var s=b("js/"+r+".js","js");s.done(function(){t=c[r];q.resolve(t)}).fail(function(){q.reject()})}return q.promise()}function a(q,w,u,z){var s=e(q);var v=d.Deferred();var y=d.Deferred();var t=d.Deferred();var r=d.Deferred();var x=v.promise();x.whenCreate=y.promise();x.whenInit=t.promise();x.whenPostDisplay=r.promise();s.done(function(E){u=m(E,u);var C=j(E);if(u.unique){var A=d("[data-bcomponent='"+q+"']");if(A.length>0){C=A.bComponent();v.resolve(C);return v}}var D=d.Deferred();if(!z){var B=h(C,w,u);if(B&&d.isFunction(B.promise)&&!B.jquery){B.done(function(F){D.resolve(F)}).fail(function(){D.reject()})}else{if(B){z=d(B)}D.resolve(z)}}else{D.resolve(z)}D.promise().done(function(F){if(F){F=d(F);f(F,C,w,u);F.data("componentProcessPromise",x);y.resolve(C);d.when(o(C,w,u)).done(function(){p(C,w,u);t.resolve(C)})}else{y.resolve(C);t.resolve(C)}x.whenInit.done(function(){var H,G;if(F&&F.parent()){var I=F.parent().closest("[data-bcomponent]");if(I.length>0){H=I.data("componentProcessPromise");if(H){H.whenPostDisplay.done(function(){G=n(C,w,u);G.done(function(){r.resolve(C)})})}}}if(!H){G=n(C,w,u);G.done(function(){r.resolve(C)})}})});x.whenPostDisplay.done(function(){v.resolve(C)})});return x}function p(r,s,q){if(q.transition){var t=brite.getTransition(q.transition);if(t){t(r,s,q)}else{brite.log.error("Transition ["+q.transition+"] not found. Transitions need to be registered via brite.registerTranstion(..) before call.")}}else{if(q.replace){d(q.replace).bRemove()}if(q.parent){if(q.emptyParent){d(q.parent).bEmpty()}d(q.parent).append(r.$element)}}}function m(r,q){var s=d.extend({},r.config,q);s.componentName=r.name;return s}function j(s){var q;var r=s.componentFactory;if(r){if(d.isFunction(r)){q=r()}else{if(d.isPlainObject(r)){q=d.extend({},r)}else{brite.log.error("Invalid ComponentFactory for component ["+s.componentName+"]. Only types Function or Object are supported as componentFactory. Empty component will be created.")}}}else{brite.log.error("No ComponentFactory for component ["+s.componentName+"]")}if(q){q.name=s.name}return q}function h(r,s,q){var t=r.create||r.build;if(!t||!d.isFunction(t)){brite.log.error("Invalid 'create' function for component ["+r.name+"].");return}return t.call(r,s,q)}function o(r,s,q){var t=r.init;if(d.isFunction(t)){return t.call(r,s,q)}}function f(q,s,t,r){s.$element=q;q.data("component",s);q.attr("data-bcomponent",r.componentName)}function n(r,u,q){var t=d.Deferred();if(r.postDisplay){if(q.postDisplayDelay>=0){setTimeout(function(){var v=r.postDisplay(u,q);if(v&&d.isFunction(v.promise)){v.done(function(){t.resolve()})}else{t.resolve()}},q.postDisplayDelay)}else{var s=r.postDisplay(u,q);if(s&&d.isFunction(s.promise)){s.done(function(){t.resolve()})}else{t.resolve()}}}else{t.resolve()}return t.promise()}function b(v,r){var q=d.Deferred();if(r==="js"){var u=document.createElement("script");u.setAttribute("type","text/javascript");u.setAttribute("src",v)}else{if(r==="css"){var u=document.createElement("link");u.setAttribute("rel","stylesheet");u.setAttribute("type","text/css");u.setAttribute("href",v)}}if(r==="js"){u.onload=function(){q.resolve(v)};u.addEventListener("error",function(){q.reject()},true)}else{if(r==="css"){var t=document.getElementsByTagName("html")[0];var s=document.createElement("img");s.onerror=function(){t.removeChild(s);q.resolve(v)};t.appendChild(s);s.src=v}}if(typeof u!="undefined"){document.getElementsByTagName("head")[0].appendChild(u)}return q.promise()}})(jQuery);(function(c){c.fn=c.fn;c.fn.bComponent=function(d){var e;if(d){e=c(this).closest("[data-bcomponent='"+d+"']")}else{e=c(this).closest("[data-bcomponent]")}return e.data("component")};c.fn.bFindComponents=function(d){var e=[];this.each(function(){var f=c(this);var g;if(d){g=c(this).find("[data-bcomponent='"+d+"']")}else{g=c(this).find("[data-bcomponent]")}g.each(function(){var h=c(this);e.push(h.data("component"))})});return e};c.fn.bFindFirstComponent=function(d){var e=[];this.each(function(){var f=c(this);var g;if(d){g=c(this).find("[data-bcomponent='"+d+"']:first")}else{g=c(this).find("[data-bcomponent]:first")}g.each(function(){var h=c(this);e.push(h.data("component"))})});return e};c.fn.bEmpty=function(){return this.each(function(){var e=c(this);var d=e.bFindComponents();c.each(d,function(g,f){a(f)});e.empty();c.each(d,function(g,f){b(f)})})};c.fn.bRemove=function(){return this.each(function(){var e=c(this);e.bEmpty();if(e.is("[data-bcomponent]")){var d=e.data("component");a(d);e.remove();b(d)}else{e.remove()}})};function a(d){if(d){var e=d.destroy||d.preRemove;if(c.isFunction(e)){e.call(d)}}}function b(e){if(e){var d=e.postDestroy||e.postRemove;if(c.isFunction(d)){d.call(e)}}}})(jQuery);(function(f){var c="INFO",d="ERROR",b="DEBUG";var g=null;brite.log={config:{debugMode:false,consoleLog:true},info:function(h){e(h)},error:function(h){e(h,d)},debug:function(h){if(brite.log.config.debugMode){e(h,b)}},addPrinter:function(h){g=g||[];g.push(h)}};function e(o,n){if(brite.log.config.consoleLog){a(o,n)}if(g){var m,k=n||c;for(var j=0,h=g.length;j<h;j++){m=g[j];m(o,k)}}}function a(i,h){if(window.console&&window.console.log){if(h){i=h+" - "+i}console.log(i)}}})(jQuery);brite.util={};(function(b){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");brite.uuid=function(c,f){var g=a,e=[];f=f||g.length;c=c||10;for(var d=0;d<c;d++){e[d]=g[0|Math.random()*f]}return e.join("")};brite.value=function(h,e){if(!h){return h}if(!e){return h}var c;var g,d,j=e.split(".");var f,k=h;for(g=0,d=j.length;g<d;g++){f=j[g];if(k==null){return undefined}k=k[f];if(typeof k==="undefined"){return k}}return k};brite.array={remove:function(c,f,e){var d=c.slice((e||f)+1||c.length);c.length=f<0?c.length+f:f;return c.push.apply(c,d)},getIndex:function(d,f,h){if(d&&f&&typeof h!="undefined"){var e,g,c=d.length;for(var e=0;e<c;e++){g=d[e];if(g&&g[f]===h){return e}}}return -1},getItem:function(d,e,f){var c=this.getIndex(d,e,f);if(c>-1){return d[c]}else{return null}},sortBy:function(c,d){return c.sort(e);function e(h,g){if(typeof h==="undefined"){return -1}if(typeof g==="undefined"){return 1}var f=h[d];var i=g[d];return((f<i)?-1:((f>i)?1:0))}},toMap:function(d,g){var f,c=d.length;var j={},h,e;for(f=0;f<c;f++){h=d[f];e=h[g];if(typeof e!="undefined"&&e!=null){j[e]=h}}return j}};brite.randomInt=function(e,d){var c=d-e;return e+Math.floor(Math.random()*(c+1))};brite.inherit=function(e,d){var c=function(){};c.prototype=d.prototype;e.prototype=new c();e._super=d.prototype;e.prototype.constructor=e}})(jQuery);brite.ua={};(function(j){var m="-webkit-",c="-moz-";var h="Webkit",q="Moz";var e;var f;var y=null;var n=null;var a=null;var s=null;var b=null;var g=null;var w={};var p=document.createElement("div");f=p.style.WebkitBorderRadius===""?m:(p.style.MozBorderRadius===""?c:(p.style.borderRadius===""?"":""));delete p;var k=(f===c);var t=(f===m);e=(k)?q:(t)?h:"";brite.ua.cssPrefix=function(){return f};brite.ua.cssVarPrefix=function(){return e};var x=["transform"];var o;for(var v=0,u=x.length;v<u;v++){o=x[v];j.cssHooks[o]=new d(o)}function d(i){this.propName=i;this.computedName=e+i.substr(0,1).toUpperCase()+i.substr(1)}d.prototype.get=function(z,l,i){return j.css(z,this.computedName)};d.prototype.set=function(i,l){i.style[this.computedName]=l};brite.ua.cssHas=function(){if(y===null){var i="has";y="";j.each(brite.ua,function(z){var l=brite.ua[z];var A;if(z.indexOf(i)===0&&j.isFunction(l)){if(l.call(brite.ua)){A="has-"+z.substring(i.length).toLowerCase();y+=A+" "}}})}return y};brite.ua.cssHasNo=function(){if(n===null){var i="has";n="";j.each(brite.ua,function(z){var l=brite.ua[z];var A;if(z.indexOf(i)===0&&j.isFunction(l)){if(!l.call(brite.ua)){A="has-no-"+z.substring(i.length).toLowerCase();n+=A+" "}}})}return n};brite.ua.supportsEvent=function(i){var l=w[i];if(typeof l==="undefined"){l=r(i);w[i]=l}return l};brite.ua.hasTouch=function(){return this.supportsEvent("touchstart")};brite.ua.hasCanvas=function(){if(b===null){var i=document.createElement("canvas");b=(i.getContext)?true:false;delete i}return b};brite.ua.hasTransition=function(){if(s===null){var i=document.createElement("div");i.innerHTML='<div style="-webkit-transition:color 1s linear;-moz-transition:color 1s linear;"></div>';g=(i.firstChild.style.webkitTransition!==undefined)?m:g;g=(i.firstChild.style.MozTransition!==undefined)?c:g;delete i;s=(g!=null)}return s};brite.ua.transitionPrefix=function(){if(this.hasTransition()){return g}else{return null}};var r=(function(){var l={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};function i(z){var B=document.createElement(l[z]||"div");z="on"+z;var A=(z in B);if(!A){B.setAttribute(z,"return;");A=typeof B[z]=="function"}B=null;return A}return i})()})(jQuery);(function(d){brite.gtx=function b(f){var g=f;if(f.jquery){f=f.get(0)}if(d.isFunction(f.getContext)){g=f.getContext("2d")}if(!(this instanceof b)){return new b(g)}this.context=this.ctx=g;if(!this.beginPath){a()}};brite.gtx.prototype.referenceScale=function(g,f){this._refWidth=g;this._refHeight=f;computeRatio.call(this);return this};brite.gtx.prototype.fitParent=function(){var f=this.canvas();if(f){var f=this.canvas();var g=d(f).parent();f.width=g.width();f.height=g.height()}return this};brite.gtx.prototype.clear=function(){if(this.canvas()){this.canvas().width=this.canvas().width}return this};brite.gtx.prototype.createLinearGradient=function(h,j,g,i){var k=this.ctx.createLinearGradient(h,j,g,i);var f=new e(k);return f};brite.gtx.prototype.createRadialGradient=function(j,l,i,h,k,g){var m=this.ctx.createRadialGradient(j,l,i,h,k,g);var f=new e(m);return f};brite.gtx.prototype.fillStyle=function(f){return c(this,"fillStyle",f)};brite.gtx.prototype.strokeStyle=function(f){return c(this,"strokeStyle",f)};function c(i,h,f){if(!f){return i.ctx[h]}if(f.ctxGradient){f=f.ctxGradient}i.ctx[h]=f;return i}function e(f){this.ctxGradient=f}e.prototype.addColorStop=function(){this.ctxGradient.addColorStop.apply(this.ctxGradient,arguments);return this};e.prototype.addColorStops=function(){for(var f=0;(f+1)<arguments.length;f+=2){this.ctxGradient.addColorStop(arguments[f],arguments[f+1])}return this};function a(){var h=["beginPath","clip","closePath","drawImage","fill","fillText","arc","arcTo","lineTo","moveTo","bezierCurveTo","quadraticCurveTo","rect","clearRect","fillRect","strokeRect","translate","rotate","save","scale","setTransform","stroke","strokeText","transform"];var o=["createPattern","drawFocusRing","isPointInPath","measureText","createImageData","getImageData","putImageData"];var q=["canvas","font","globalAlpha","globalCompositeOperation","lineCap","lineJoin","lineWidth","miterLimit","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","textAlign","textBaseline"];var g,r;for(var l=0,n=h.length;l<n;l++){var j=h[l];brite.gtx.prototype[j]=(function(i){return function(){this.ctx[i].apply(this.ctx,arguments);return this}}(j))}for(l=0,g=o.length;l<g;l++){var k=o[l];brite.gtx.prototype[k]=(function(i){return function(){return this.ctx[i].apply(this.ctx,arguments)}}(k))}for(l=0,r=q.length;l<r;l++){var f=q[l];brite.gtx.prototype[f]=(function(i){return function(m){if(typeof m==="undefined"){return this.ctx[i]}this.ctx[i]=m;return this}}(f))}}})(jQuery);var brite=brite||{};brite.dm={};(function(e){var b={};var a={};var g={};function h(k){var j=b[k];if(j){return j}else{var l="Cannot find the DAO for objectType: "+k;brite.log.error(l);throw l}}brite.registerDao=function(k,j){b[k]=j;return this};brite.addDaoListener=function(j){var k=brite.uuid();g[k]=j;return k};brite.removeDaoListener=function(j){delete g[j]};brite.addDataChangeListener=function(j,m){var l=brite.uuid();var k=a[j];if(!k){k={};a[j]=k}k[l]=m;return l};brite.removeDataChangeListener=function(j){e.each(a,function(k,l){delete l[j]})};brite.dm.getIdName=function(j){return brite.sdm.getIdName(j)};brite.dm.get=function(j,k){return c(brite.sdm.get(j,k))};brite.dm.list=function(j,k){return c(brite.sdm.list(j,k))};brite.dm.create=function(j,k){return c(brite.sdm.create(j,k))};brite.dm.update=function(j,l,k){return c(brite.sdm.update(j,l,k))};brite.dm.remove=function(j,k){return c(brite.sdm.remove(j,k))};brite.dm.invoke=function(k,j){var l=Array.prototype.slice.call(arguments,0);return c(brite.sdm.invoke.apply(null,l))};brite.sdm={};brite.sdm.getIdName=function(j){return h(j).getIdName(j)};brite.sdm.get=function(k,l){var j=h(k).get(k,l);d(j,"get",k,l);return j};brite.sdm.list=function(k,l){var j=h(k).list(k,l);d(j,"list",k,null,null,l);return j};brite.sdm.create=function(k,l){var j=h(k).create(k,l);d(j,"create",k,null,l);if(j&&e.isFunction(j.promise)){j.done(function(m){i("create",k,null,m,l)})}else{i("create",k,null,j,l)}return j};brite.sdm.update=function(k,m,l){var j=h(k).update(k,m,l);d(j,"update",k,m,l);if(j&&e.isFunction(j.promise)){j.done(function(n){i("update",k,m,n,l)})}else{i("update",k,m,j,l)}return j};brite.sdm.remove=function(k,l){var j=h(k).remove(k,l);d(j,"remove",k,l);if(j&&e.isFunction(j.promise)){j.done(function(m){i("remove",k,l,null,null)})}else{i("remove",k,l,null,null)}};brite.sdm.invoke=function(m,l){var n=Array.prototype.slice.call(arguments);var k=h(l);if(!k){throw ("cannot find dao for "+l)}if(!k[m]){throw ("no custom method for "+method)}var j=k[m].apply(k,n.slice(1));d(j,m,l);return j};function d(j,o,k,p,n,l){var m={result:j,action:o,objectType:k,id:p,data:n,opts:l};e.each(g,function(q,r){r(m)})}function i(n,k,o,m,j){var l={action:n,objectType:k,id:o,newData:m,saveData:j};f(l)}function f(k){var j=k.objectType;var l=a[j];if(l){e.each(l,function(m,n){n(k)})}}brite.triggerDataChange=function(j){f(j)};function c(k){if(k&&e.isFunction(k.promise)){return k}else{var j=e.Deferred();j.resolve(k);return j}}})(jQuery);brite.dao={};(function(b){function a(c){this.init(c)}a.prototype.init=function(c){this._store=c||[];return this};a.prototype.getIdName=function(c){return"id"};a.prototype.get=function(d,e){var c=brite.array.getIndex(this._store,"id",e);return this._store[c]};a.prototype.list=function(c,e){var d=this._store;if(e){if(e.orderBy){d=brite.array.sortBy(d,e.orderBy)}if(e.match){d=b.map(d,function(h,f){var g=true;b.each(e.match,function(j,i){if(h[j]===i){g=g&&true}else{g=false}});return(g)?h:null})}}return d};a.prototype.create=function(c,e){var d=brite.dm.getIdName(c);if(typeof e[d]!=="undefined"){var f="SimpleDao.create error: Id present in data object. Cannot create. You might want to call update instead.";brite.log.debug(f);throw f}e[d]=brite.uuid(12);this._store.push(e);return e};a.prototype.update=function(c,i,g){var e=brite.dm.getIdName(c);var d=g[e];if(typeof d!=="undefined"&&d!=i){var h="SimpleDao.update error: Id in param and data does not match. Cannot update data.";brite.log.debug(h);throw h}delete g[e];var f=this.get(c,i);if(f){b.extend(f,g);return f}};a.prototype.remove=function(d,g){var e=this.get(d,g);var c=brite.array.getIndex(this._store,"id",g);if(c>-1){brite.array.remove(this._store,c)}else{var f="SimpleDao.remove error: Ojbect "+d+"["+g+"] not found. Cannot delete.";brite.log.debug(f);throw f}return g};brite.dao.SimpleDao=a})(jQuery);(function(c){function b(e,f){this._super.init.call(this,e);this._rels=f;this._relDic={};for(var g=0,d=f.length;g<d;g++){this._relDic[f[g]]=f[g]+"_id"}}brite.inherit(b,brite.dao.SimpleDao);b.prototype.get=function(e,f){var d=this._super.get.call(this,e,f);return a.call(this,d)};b.prototype.list=function(e,g){var f=this._super.list.call(this,e,g);if(this._rels){var d=this;c.each(f,function(h,i){a.call(d,i)})}return f};b.prototype.save=function(g,j){if(this._rels){var e;for(var h=0,f=this._rels.length;h<f;h++){e=this._rels[h];if(typeof j[e]!=="undefined"){delete j[e]}}}var d=this._super.save.call(this,g,j);return a.call(this,d)};function a(k){var f=this._rels;var d,e,j,h;for(var g=0;g<f.length;g++){d=f[g];e=this._relDic[d];h=k[e];if(typeof h!=="undefined"){j=brite.dm.get(d,h);if(typeof j!=="undefined"&&j!=null){k[d]=j}}}return k}brite.dao.SimpleRelDao=b})(jQuery);(function(a){a.fn.bObjRef=function(d){var b=[];var c=null;this.each(function(){var f=a(this);var e;if(d){e=f.closest("[data-obj_type='"+d+"']")}else{e=f.closest("[data-obj_type]")}if(e.length>0){var g={type:e.attr("data-obj_type"),id:e.attr("data-obj_id"),$element:e};b.push(g)}});if(b.length===0){return null}else{if(b.length===1){return b[0]}else{return b}}}})(jQuery);var brite=brite||{};brite.event=brite.event||{};(function(b){var a=brite.ua.hasTouch();brite.event.fixTouchEvent=function(c){if(a){var d=c.originalEvent;if(d.touches.length>0){c.pageX=d.touches[0].pageX;c.pageY=d.touches[0].pageY}}return c};brite.event.eventPagePosition=function(c){if(c.originalEvent&&c.originalEvent.touches){pageX=c.originalEvent.touches[0].pageX;pageY=c.originalEvent.touches[0].pageY}else{pageX=c.pageX;pageY=c.pageY}return{pageX:pageX,pageY:pageY}}})(jQuery);(function(a){a.fn.bTouch=function(d,c){var f=c||d;var e=(c)?d:null;var b=(brite.ua.hasTouch())?"touchend":"click";return this.each(function(){var g=a(this);if(e){g.delegate(e,b,f)}else{g.bind(b,f)}})};a.fn.bTouch.defaults={}})(jQuery);(function(h){var k="bdragstart",o="bdrag",n="bdragend";var c="bdragenter",b="bdragover",j="bdragleave",f="bdrop";var m={start:"mousedown",drag:"mousemove",end:"mouseup"};var i={start:"touchstart",drag:"touchmove",end:"touchend"};h.fn.bDrag=function(r,s){var p=s||r;var r=(s)?r:null;var t=brite.ua.hasTouch();p=h.extend({},h.fn.bDrag.defaults,p);var u=(t)?i:m;return this.each(function(){var v=h(this);if(r==null){(p.start)?v.bind(k,p.start):null;(p.drag)?v.bind(o,p.drag):null;(p.end)?v.bind(n,p.end):null;v.bind(u.start,function(w){q.call(this,w,p)})}else{(p.start)?v.delegate(r,k,p.start):null;(p.drag)?v.delegate(r,o,p.drag):null;(p.end)?v.delegate(r,n,p.end):null;v.delegate(r,u.start,function(w){q.call(this,w,p)})}});function q(B,D){var w=h(this);var y=h(document);var v="_"+brite.uuid(7);var x=false;var A=B;var z=brite.event.eventPagePosition(A);var C;B.preventDefault();y.bind(u.drag+"."+v,function(J){if(!x){var H=brite.event.eventPagePosition(J);if(Math.abs(z.pageX-H.pageY)>D.threshold){x=true;w.data("bDragCtx",{});if(D.draggable===true){if(h.isFunction(D.helper)){C=h(D.helper.call(w.get(0)))}else{if(D.helper==="original"){C=w}else{if(D.helper==="clone"){C=w.clone();C.attr("id",null);C.css("position","absolute");var I=w.offset();C.css({top:I.top,left:I.left});h("body").append(C)}}}}var F=g(A,w,C,k);w.trigger(k,[F])}}if(x){var G=g(J,w,C,o);var E;if(D.draggable===true){E=e(C,G);G.overElement=E}w.trigger(o,[G]);if(D.draggable===true){a(C,G);var K=l(w,C);d(b,J,w,E,K)}J.preventDefault();J.stopPropagation()}});y.bind(u.end+"."+v,function(G){if(x){var F=g(G,w,C,n);var H;var E;if(D.draggable===true){E=e(C,F);F.overElement=E}w.trigger(n,[F]);if(D.draggable===true){a(C,F);H=l(w,C);d(f,G,w,E,H);if(!C.is(w)){C.remove()}}w.data("bDragCtx",null);G.preventDefault();G.stopPropagation()}h(document).unbind(u.drag+"."+v);h(document).unbind(u.end+"."+v)})}};function a(q,p){var r=q.position();q.css({left:r.left+p.deltaPageX,top:r.top+p.deltaPageY})}function d(t,s,u,z,x){var v=h(z);var r=u.data("bDragCtx");var y=r.overElem;var w,q;if(typeof y==="undefined"){w=h.Event(s);w.target=z;w.type=c;v.trigger(w,x)}else{if(y!=z){q=h.Event(s);q.target=y;q.type=j;h(y).trigger(q,x);w=h.Event(s);w.target=z;w.type=c;v.trigger(w,x)}}r.overElem=z;var p=h.Event(s);p.target=z;p.type=t;v.trigger(p,x)}function e(r,q){r.hide();var p=document.elementFromPoint(q.pageX,q.pageY);r.show();return p}function g(t,q,v,s){brite.event.fixTouchEvent(t);var u=brite.ua.hasTouch();var p={eventSource:t,pageX:t.pageX,pageY:t.pageY};if(v){p.helperElement=v.get(0)}var w=t.originalEvent;if(u){p.touches=w.touches}var r=q.data("bDragCtx");if(s===k){r.startPageX=p.startPageX=p.pageX;r.startPageY=p.startPageY=p.pageY;r.lastPageX=r.startPageX=p.startPageX;r.lastPageY=r.startPageY=p.startPageY}else{if(s===n){p.pageX=r.lastPageX;p.pageY=r.lastPageY}}p.startPageX=r.startPageX;p.startPageY=r.startPageY;p.deltaPageX=p.pageX-r.lastPageX;p.deltaPageY=p.pageY-r.lastPageY;r.lastPageX=p.pageX;r.lastPageY=p.pageY;return p}function l(q,r){var p={};p.draggableElement=q.get(0);p.helperElement=r.get(0);return p}h.fn.bDrag.defaults={draggable:false,helper:"original",threshold:5}})(jQuery);