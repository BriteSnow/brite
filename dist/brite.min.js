var brite=brite||{};brite.version="0.9-snapshot";(function(e){var b=0;var d={};var l={};var m={};var h={};brite.registerComponent=function(t,s,v){var u={};u.name=t;u.componentFactory=v;u.config=e.extend({},this.defaultComponentConfig,s);d[t]=u;var r=m[t];if(r){r.resolve(u);delete m[t]}};brite.instantiateComponent=function(r){var s=f(r);return k(componentDef)};brite.registerTransition=function(r,s){h[r]=s};brite.getTransition=function(r){return h[r]};brite.display=function(r,t,s){return a(r,t,s)};brite.attach=function(s,r,u,t){return a(s,u,t,r)};brite.config={componentsHTMLHolder:"body",tmplPath:"tmpl/",tmplExt:".tmpl"};brite.defaultComponentConfig={loadTmpl:false,loadCss:false,emptyParent:false,postDisplayDelay:0};function f(r){var t=e.Deferred();var s=j(r);s.done(function(C){var y,z;var u=C.config.loadTmpl;if(u&&!l[r]){var x=true;var E=C.config.checkTemplate;if(E){var B=(typeof E=="string")?E:("#tmpl-"+r);if(e(B).length>0){x=false}}if(x){y=e.Deferred();var D=(typeof u=="string")?D:(r+".html");e.ajax({url:brite.config.tmplPath+r+brite.config.tmplExt,async:true}).complete(function(F,G){e(brite.config.componentsHTMLHolder).append(F.responseText);l[r]=true;y.resolve()})}}var A=brite.defaultComponentConfig.loadCss;if(A){z=e.Deferred();var v="css/"+r+".css";var w=c(v,"css");w.done(function(){z.resolve()}).fail(function(){console.log("Brite ERROR: cannot load "+v+". Ignoring issue");z.resolve()})}e.when(y,z).done(function(){t.resolve(C)})});s.fail(function(u){console.log("BRITE-ERROR: Brite cannot load component: "+r+"\n\t "+u);t.reject()});return t.promise()}function j(s){var r=e.Deferred();var v=d[s];if(v){r.resolve(v)}else{var t="js/"+s+".js";var u=c(t,"js");u.done(function(){v=d[s];if(v){r.resolve(v)}else{r.reject("Component js file ["+t+"] loaded, but it did not seem to have registered the component - it needs to call brite.registerComponent('"+s+"',...config...) - see documentation")}}).fail(function(){r.reject("Component resource file "+t+" not found")})}return r.promise()}function a(r,x,v,A){var t=f(r);var w=e.Deferred();var z=e.Deferred();var u=e.Deferred();var s=e.Deferred();var y=w.promise();y.whenCreate=z.promise();y.whenInit=u.promise();y.whenPostDisplay=s.promise();t.done(function(F){v=n(F,v);var D=k(F);if(v.unique){var B=e("[data-brite-component='"+r+"']");if(B.length>0){D=B.bComponent();w.resolve(D);return w}}var E=e.Deferred();if(!A){var C=i(D,x,v);if(C&&e.isFunction(C.promise)&&!C.jquery){C.done(function(G){E.resolve(G)}).fail(function(){E.reject()})}else{if(C){A=e(C)}E.resolve(A)}}else{E.resolve(A)}E.promise().done(function(G){if(G){G=e(G);g(G,D,x,v);G.data("componentProcessPromise",y);z.resolve(D);e.when(p(D,x,v)).done(function(){q(D,x,v);u.resolve(D)})}else{z.resolve(D);u.resolve(D)}y.whenInit.done(function(){var I,H;if(G&&G.parent()){var J=G.parent().closest("[data-brite-component]");if(J.length>0){I=J.data("componentProcessPromise");if(I){I.whenPostDisplay.done(function(){H=o(D,x,v);H.done(function(){s.resolve(D)})})}}}if(!I){H=o(D,x,v);H.done(function(){s.resolve(D)})}})});y.whenPostDisplay.done(function(){w.resolve(D)})});t.fail(function(){w.reject();z.reject();u.reject();s.reject()});return y}function q(s,t,r){if(r.transition){var u=brite.getTransition(r.transition);if(u){u(s,t,r)}else{brite.log.error("Transition ["+r.transition+"] not found. Transitions need to be registered via brite.registerTranstion(..) before call.")}}else{if(r.replace){e(r.replace).bRemove()}if(r.parent){if(r.emptyParent){e(r.parent).bEmpty()}e(r.parent).append(s.$element)}}}function n(s,r){var t=e.extend({},s.config,r);t.componentName=s.name;return t}function k(t){var r;var s=t.componentFactory;if(s){if(e.isFunction(s)){r=s()}else{if(e.isPlainObject(s)){r=e.extend({},s)}else{brite.log.error("Invalid ComponentFactory for component ["+t.componentName+"]. Only types Function or Object are supported as componentFactory. Empty component will be created.")}}}else{brite.log.error("No ComponentFactory for component ["+t.componentName+"]")}if(r){r.name=t.name;r.cid=b++}return r}function i(s,t,r){var u=s.create||s.build;if(!u||!e.isFunction(u)){brite.log.error("Invalid 'create' function for component ["+s.name+"].");return}return u.call(s,t,r)}function p(s,t,r){var u=s.init;if(e.isFunction(u)){return u.call(s,t,r)}}function g(r,t,u,s){t.$element=r;r.data("component",t);r.attr("data-brite-component",s.componentName);r.attr("data-brite-cid",t.cid)}function o(s,v,r){var u=e.Deferred();if(s.postDisplay){if(r.postDisplayDelay>=0){setTimeout(function(){var w=s.postDisplay(v,r);if(w&&e.isFunction(w.promise)){w.done(function(){u.resolve()})}else{u.resolve()}},r.postDisplayDelay)}else{var t=s.postDisplay(v,r);if(t&&e.isFunction(t.promise)){t.done(function(){u.resolve()})}else{u.resolve()}}}else{u.resolve()}return u.promise()}function c(w,s){var r=e.Deferred();if(s==="js"){var v=document.createElement("script");v.setAttribute("type","text/javascript");v.setAttribute("src",w)}else{if(s==="css"){var v=document.createElement("link");v.setAttribute("rel","stylesheet");v.setAttribute("type","text/css");v.setAttribute("href",w)}}if(s==="js"){v.onload=function(){r.resolve(w)};v.addEventListener("error",function(){r.reject()},true)}else{if(s==="css"){var u=document.getElementsByTagName("html")[0];var t=document.createElement("img");e(t).css("display","none");t.onerror=function(){u.removeChild(t);r.resolve(w)};u.appendChild(t);t.src=w}}if(typeof v!="undefined"){document.getElementsByTagName("head")[0].appendChild(v)}return r.promise()}})(jQuery);(function(c){c.fn=c.fn;c.fn.bComponent=function(d){var e;if(d){e=c(this).closest("[data-brite-component='"+d+"']")}else{e=c(this).closest("[data-brite-component]")}return e.data("component")};c.fn.bFindComponents=function(d){var e=[];this.each(function(){var f=c(this);var g;if(d){g=c(this).find("[data-brite-component='"+d+"']")}else{g=c(this).find("[data-brite-component]")}g.each(function(){var h=c(this);e.push(h.data("component"))})});return e};c.fn.bFindFirstComponent=function(d){var e=[];this.each(function(){var f=c(this);var g;if(d){g=c(this).find("[data-brite-component='"+d+"']:first")}else{g=c(this).find("[data-brite-component]:first")}g.each(function(){var h=c(this);e.push(h.data("component"))})});return e};c.fn.bEmpty=function(){return this.each(function(){var e=c(this);var d=e.bFindComponents();c.each(d,function(g,f){a(f)});e.empty();c.each(d,function(g,f){b(f)})})};c.fn.bRemove=function(){return this.each(function(){var e=c(this);e.bEmpty();if(e.is("[data-brite-component]")){var d=e.data("component");a(d);e.remove();b(d)}else{e.remove()}})};function a(d){if(d){var e=d.destroy||d.preRemove;if(c.isFunction(e)){e.call(d)}}}function b(e){if(e){var d=e.postDestroy||e.postRemove;if(c.isFunction(d)){d.call(e)}}}})(jQuery);(function(f){var c="INFO",d="ERROR",b="DEBUG";var g=null;brite.log={config:{debugMode:false,consoleLog:true},info:function(h){e(h)},error:function(h){e(h,d)},debug:function(h){if(brite.log.config.debugMode){e(h,b)}},addPrinter:function(h){g=g||[];g.push(h)}};function e(o,n){if(brite.log.config.consoleLog){a(o,n)}if(g){var m,k=n||c;for(var j=0,h=g.length;j<h;j++){m=g[j];m(o,k)}}}function a(i,h){if(window.console&&window.console.log){if(h){i=h+" - "+i}console.log(i)}}})(jQuery);brite.util={};(function(b){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");brite.uuid=function(c,f){var g=a,e=[];f=f||g.length;c=c||10;for(var d=0;d<c;d++){e[d]=g[0|Math.random()*f]}return e.join("")};brite.value=function(h,e){if(!h){return h}if(!e){return h}var c;var g,d,j=e.split(".");var f,k=h;for(g=0,d=j.length;g<d;g++){f=j[g];if(k==null){return undefined}k=k[f];if(typeof k==="undefined"){return k}}return k};brite.array={remove:function(c,f,e){var d=c.slice((e||f)+1||c.length);c.length=f<0?c.length+f:f;return c.push.apply(c,d)},getIndex:function(d,f,h){if(d&&f&&typeof h!="undefined"){var e,g,c=d.length;for(var e=0;e<c;e++){g=d[e];if(g&&g[f]===h){return e}}}return -1},getItem:function(d,e,f){var c=this.getIndex(d,e,f);if(c>-1){return d[c]}else{return null}},sortBy:function(c,d){return c.sort(e);function e(h,g){if(typeof h==="undefined"){return -1}if(typeof g==="undefined"){return 1}var f=h[d];var i=g[d];return((f<i)?-1:((f>i)?1:0))}},toMap:function(d,g){var f,c=d.length;var j={},h,e;for(f=0;f<c;f++){h=d[f];e=h[g];if(typeof e!="undefined"&&e!=null){j[e]=h}}return j}};brite.randomInt=function(e,d){var c=d-e;return e+Math.floor(Math.random()*(c+1))};brite.inherit=function(e,d){var c=function(){};c.prototype=d.prototype;e.prototype=new c();e._super=d.prototype;e.prototype.constructor=e}})(jQuery);brite.ua={};(function(j){var m="-webkit-",c="-moz-";var h="Webkit",q="Moz";var e;var f;var y=null;var n=null;var a=null;var s=null;var b=null;var g=null;var w={};var p=document.createElement("div");f=p.style.WebkitBorderRadius===""?m:(p.style.MozBorderRadius===""?c:(p.style.borderRadius===""?"":""));delete p;var k=(f===c);var t=(f===m);e=(k)?q:(t)?h:"";brite.ua.cssPrefix=function(){return f};brite.ua.cssVarPrefix=function(){return e};var x=["transform"];var o;for(var v=0,u=x.length;v<u;v++){o=x[v];j.cssHooks[o]=new d(o)}function d(i){this.propName=i;this.computedName=e+i.substr(0,1).toUpperCase()+i.substr(1)}d.prototype.get=function(z,l,i){return j.css(z,this.computedName)};d.prototype.set=function(i,l){i.style[this.computedName]=l};brite.ua.cssHas=function(){if(y===null){var i="has";y="";j.each(brite.ua,function(z){var l=brite.ua[z];var A;if(z.indexOf(i)===0&&j.isFunction(l)){if(l.call(brite.ua)){A="has-"+z.substring(i.length).toLowerCase();y+=A+" "}}})}return y};brite.ua.cssHasNo=function(){if(n===null){var i="has";n="";j.each(brite.ua,function(z){var l=brite.ua[z];var A;if(z.indexOf(i)===0&&j.isFunction(l)){if(!l.call(brite.ua)){A="has-no-"+z.substring(i.length).toLowerCase();n+=A+" "}}})}return n};brite.ua.supportsEvent=function(i){var l=w[i];if(typeof l==="undefined"){l=r(i);w[i]=l}return l};brite.ua.hasTouch=function(){return this.supportsEvent("touchstart")};brite.ua.hasCanvas=function(){if(b===null){var i=document.createElement("canvas");b=(i.getContext)?true:false;delete i}return b};brite.ua.hasTransition=function(){if(s===null){var i=document.createElement("div");i.innerHTML='<div style="-webkit-transition:color 1s linear;-moz-transition:color 1s linear;"></div>';g=(i.firstChild.style.webkitTransition!==undefined)?m:g;g=(i.firstChild.style.MozTransition!==undefined)?c:g;delete i;s=(g!=null)}return s};brite.ua.transitionPrefix=function(){if(this.hasTransition()){return g}else{return null}};var r=(function(){var l={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};function i(z){var B=document.createElement(l[z]||"div");z="on"+z;var A=(z in B);if(!A){B.setAttribute(z,"return;");A=typeof B[z]=="function"}B=null;return A}return i})()})(jQuery);(function(d){brite.gtx=function b(f){var g=f;if(f.jquery){f=f.get(0)}if(d.isFunction(f.getContext)){g=f.getContext("2d")}if(!(this instanceof b)){return new b(g)}this.context=this.ctx=g;if(!this.beginPath){a()}};brite.gtx.prototype.referenceScale=function(g,f){this._refWidth=g;this._refHeight=f;computeRatio.call(this);return this};brite.gtx.prototype.fitParent=function(){var f=this.canvas();if(f){var f=this.canvas();var g=d(f).parent();f.width=g.width();f.height=g.height()}return this};brite.gtx.prototype.clear=function(){if(this.canvas()){this.canvas().width=this.canvas().width}return this};brite.gtx.prototype.createLinearGradient=function(h,j,g,i){var k=this.ctx.createLinearGradient(h,j,g,i);var f=new e(k);return f};brite.gtx.prototype.createRadialGradient=function(j,l,i,h,k,g){var m=this.ctx.createRadialGradient(j,l,i,h,k,g);var f=new e(m);return f};brite.gtx.prototype.fillStyle=function(f){return c(this,"fillStyle",f)};brite.gtx.prototype.strokeStyle=function(f){return c(this,"strokeStyle",f)};function c(i,h,f){if(!f){return i.ctx[h]}if(f.ctxGradient){f=f.ctxGradient}i.ctx[h]=f;return i}function e(f){this.ctxGradient=f}e.prototype.addColorStop=function(){this.ctxGradient.addColorStop.apply(this.ctxGradient,arguments);return this};e.prototype.addColorStops=function(){for(var f=0;(f+1)<arguments.length;f+=2){this.ctxGradient.addColorStop(arguments[f],arguments[f+1])}return this};function a(){var h=["beginPath","clip","closePath","drawImage","fill","fillText","arc","arcTo","lineTo","moveTo","bezierCurveTo","quadraticCurveTo","rect","clearRect","fillRect","strokeRect","translate","rotate","save","scale","setTransform","stroke","strokeText","transform"];var o=["createPattern","drawFocusRing","isPointInPath","measureText","createImageData","getImageData","putImageData"];var q=["canvas","font","globalAlpha","globalCompositeOperation","lineCap","lineJoin","lineWidth","miterLimit","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","textAlign","textBaseline"];var g,r;for(var l=0,n=h.length;l<n;l++){var j=h[l];brite.gtx.prototype[j]=(function(i){return function(){this.ctx[i].apply(this.ctx,arguments);return this}}(j))}for(l=0,g=o.length;l<g;l++){var k=o[l];brite.gtx.prototype[k]=(function(i){return function(){return this.ctx[i].apply(this.ctx,arguments)}}(k))}for(l=0,r=q.length;l<r;l++){var f=q[l];brite.gtx.prototype[f]=(function(i){return function(m){if(typeof m==="undefined"){return this.ctx[i]}this.ctx[i]=m;return this}}(f))}}})(jQuery);var brite=brite||{};brite.dao={};(function(e){var b={};var a={};var g={};function h(k){var j=b[k];if(j){return j}else{var l="Cannot find the DAO for objectType: "+k;brite.log.error(l);throw l}}brite.registerDao=function(k,j){b[k]=j;return this};brite.addDaoListener=function(j){var k=brite.uuid();g[k]=j;return k};brite.removeDaoListener=function(j){delete g[j]};brite.addDataChangeListener=function(j,m){var l=brite.uuid();var k=a[j];if(!k){k={};a[j]=k}k[l]=m;return l};brite.removeDataChangeListener=function(j){e.each(a,function(k,l){delete l[j]})};brite.dao.getIdName=function(j){return brite.sdm.getIdName(j)};brite.dao.get=function(j,k){return c(brite.sdm.get(j,k))};brite.dao.list=function(j,k){return c(brite.sdm.list(j,k))};brite.dao.create=function(j,k){return c(brite.sdm.create(j,k))};brite.dao.update=function(j,l,k){return c(brite.sdm.update(j,l,k))};brite.dao.remove=function(j,k){return c(brite.sdm.remove(j,k))};brite.dao.invoke=function(k,j){var l=Array.prototype.slice.call(arguments,0);return c(brite.sdm.invoke.apply(null,l))};brite.sdm={};brite.sdm.getIdName=function(j){return h(j).getIdName(j)};brite.sdm.get=function(k,l){var j=h(k).get(k,l);d(j,"get",k,l);return j};brite.sdm.list=function(k,l){var j=h(k).list(k,l);d(j,"list",k,null,null,l);return j};brite.sdm.create=function(k,l){var j=h(k).create(k,l);d(j,"create",k,null,l);if(j&&e.isFunction(j.promise)){j.done(function(m){i("create",k,null,m,l)})}else{i("create",k,null,j,l)}return j};brite.sdm.update=function(k,m,l){var j=h(k).update(k,m,l);d(j,"update",k,m,l);if(j&&e.isFunction(j.promise)){j.done(function(n){i("update",k,m,n,l)})}else{i("update",k,m,j,l)}return j};brite.sdm.remove=function(k,l){var j=h(k).remove(k,l);d(j,"remove",k,l);if(j&&e.isFunction(j.promise)){j.done(function(m){i("remove",k,l,null,null)})}else{i("remove",k,l,null,null)}};brite.sdm.invoke=function(m,l){var n=Array.prototype.slice.call(arguments);var k=h(l);if(!k){throw ("cannot find dao for "+l)}if(!k[m]){throw ("no custom method for "+method)}var j=k[m].apply(k,n.slice(1));d(j,m,l);return j};function d(j,o,k,p,n,l){var m={result:j,action:o,objectType:k,id:p,data:n,opts:l};e.each(g,function(q,r){r(m)})}function i(n,k,o,m,j){var l={action:n,objectType:k,id:o,newData:m,saveData:j};f(l)}function f(k){var j=k.objectType;var l=a[j];if(l){e.each(l,function(m,n){n(k)})}}brite.triggerDataChange=function(j){f(j)};function c(k){if(k&&e.isFunction(k.promise)){return k}else{var j=e.Deferred();j.resolve(k);return j}}})(jQuery);(function(b){function a(c){this.init(c)}a.prototype.init=function(c){this._store=c||[];return this};a.prototype.getIdName=function(c){return"id"};a.prototype.get=function(d,e){var c=brite.array.getIndex(this._store,"id",e);return this._store[c]};a.prototype.list=function(c,e){var d=this._store;if(e){if(e.orderBy){d=brite.array.sortBy(d,e.orderBy)}if(e.match){d=b.map(d,function(h,f){var g=true;b.each(e.match,function(j,i){if(h[j]===i){g=g&&true}else{g=false}});return(g)?h:null})}}return d};a.prototype.create=function(c,e){var d=brite.dao.getIdName(c);if(typeof e[d]!=="undefined"){var f="SimpleDao.create error: Id present in data object. Cannot create. You might want to call update instead.";brite.log.debug(f);throw f}e[d]=brite.uuid(12);this._store.push(e);return e};a.prototype.update=function(c,i,g){var e=brite.dao.getIdName(c);var d=g[e];if(typeof d!=="undefined"&&d!=i){var h="SimpleDao.update error: Id in param and data does not match. Cannot update data.";brite.log.debug(h);throw h}delete g[e];var f=this.get(c,i);if(f){b.extend(f,g);return f}};a.prototype.remove=function(d,g){var e=this.get(d,g);var c=brite.array.getIndex(this._store,"id",g);if(c>-1){brite.array.remove(this._store,c)}else{var f="SimpleDao.remove error: Ojbect "+d+"["+g+"] not found. Cannot delete.";brite.log.debug(f);throw f}return g};brite.dao.SimpleDao=a})(jQuery);(function(a){a.fn.bObjRef=function(d){var b=[];var c=null;this.each(function(){var f=a(this);var e;if(d){e=f.closest("[data-obj_type='"+d+"']")}else{e=f.closest("[data-obj_type]")}if(e.length>0){var g={type:e.attr("data-obj_type"),id:e.attr("data-obj_id"),$element:e};b.push(g)}});if(b.length===0){return null}else{if(b.length===1){return b[0]}else{return b}}}})(jQuery);var brite=brite||{};brite.event=brite.event||{};(function(b){var a=brite.ua.hasTouch();brite.event.fixTouchEvent=function(c){if(a){var d=c.originalEvent;if(d.touches.length>0){c.pageX=d.touches[0].pageX;c.pageY=d.touches[0].pageY}}return c};brite.event.eventPagePosition=function(f){var d,c;if(f.originalEvent&&f.originalEvent.touches){d=f.originalEvent.touches[0].pageX;c=f.originalEvent.touches[0].pageY}else{d=f.pageX;c=f.pageY}return{pageX:d,pageY:c}}})(jQuery);(function(f){var o={start:"mousedown",move:"mousemove",end:"mouseup"};var i={start:"touchstart",move:"touchmove",end:"touchend"};function b(){if(brite.ua.hasTouch()){return i}else{return o}}f.event.special.btap={setup:function(r,q){var p=b();f(this).on(p.start,function(x){var w=this;var t=f(w);var v=x.target,s=x,z;function y(A){u();if(A.target===v){brite.event.fixTouchEvent(s);h(w,s,{type:"btap"})}}function u(){clearTimeout(z);t.off(p.end,y)}t.on(p.end,y);z=setTimeout(function(){brite.event.fixTouchEvent(s);h(w,s,{type:"btaphold"})},750)})}};k(["btaphold"],"btap");var l="bdragstart",m="bdragmove",n="bdragend";var c="bdragenter",a="bdragover",g="bdragleave",d="bdrop";var j=5;f.event.special[m]={setup:function(r,q){var p=b();f(this).on(p.start,function(s){var v=this;var t=f(this);var u=false;var z=s;var y=brite.event.eventPagePosition(z);var B=s.target;var w=f(B);var x=f(document);var A="_"+brite.uuid(7);x.on(p.move+"."+A,function(E){var C=brite.event.eventPagePosition(E);if(!u){if(Math.abs(y.pageX-C.pageX)>j||Math.abs(y.pageY-C.pageY)>j){u=true;w.data("bDragCtx",{});var D=e(E,w,l);h(B,E,{type:l,target:B,bextra:D});E.stopPropagation();E.preventDefault()}}if(u){var D=e(E,w,m);h(B,E,{type:m,target:B,bextra:D});E.stopPropagation();E.preventDefault()}});x.on(p.end+"."+A,function(D){if(u){var C=e(D,w,n);h(B,D,{type:n,target:B,bextra:C});D.stopPropagation();D.preventDefault()}x.off("."+A)})})}};k([l,n],m);function e(t,q,s){brite.event.fixTouchEvent(t);var u=brite.ua.hasTouch();var p={eventSource:t,pageX:t.pageX,pageY:t.pageY};var v=t.originalEvent;if(u){p.touches=v.touches}var r=q.data("bDragCtx");if(s===l){r.startPageX=p.startPageX=p.pageX;r.startPageY=p.startPageY=p.pageY;r.lastPageX=r.startPageX=p.startPageX;r.lastPageY=r.startPageY=p.startPageY}else{if(s===n){p.pageX=r.lastPageX;p.pageY=r.lastPageY}}p.startPageX=r.startPageX;p.startPageY=r.startPageY;p.deltaX=p.pageX-r.lastPageX;p.deltaY=p.pageY-r.lastPageY;r.lastPageX=p.pageX;r.lastPageY=p.pageY;return p}function k(q,p){f.each(q,function(r,s){f.event.special[s]={setup:function(){f(this).bind(p,f.noop)}}})}function h(r,p,q){var s=jQuery.extend(new jQuery.Event(),p,q);f(r).trigger(s)}})(jQuery);(function(h){var k="bdragstart",o="bdrag",n="bdragend";var c="bdragenter",b="bdragover",j="bdragleave",f="bdrop";var m={start:"mousedown",drag:"mousemove",end:"mouseup"};var i={start:"touchstart",drag:"touchmove",end:"touchend"};h.fn.bDrag=function(r,s){var p=s||r;var r=(s)?r:null;var t=brite.ua.hasTouch();p=h.extend({},h.fn.bDrag.defaults,p);var u=(t)?i:m;return this.each(function(){var v=h(this);if(r==null){(p.start)?v.bind(k,p.start):null;(p.drag)?v.bind(o,p.drag):null;(p.end)?v.bind(n,p.end):null;v.bind(u.start,function(w){q.call(this,w,p)})}else{(p.start)?v.delegate(r,k,p.start):null;(p.drag)?v.delegate(r,o,p.drag):null;(p.end)?v.delegate(r,n,p.end):null;v.delegate(r,u.start,function(w){q.call(this,w,p)})}});function q(B,D){var w=h(this);var y=h(document);var v="_"+brite.uuid(7);var x=false;var A=B;var z=brite.event.eventPagePosition(A);var C;B.preventDefault();y.bind(u.drag+"."+v,function(J){if(!x){var H=brite.event.eventPagePosition(J);if(Math.abs(z.pageX-H.pageY)>D.threshold){x=true;w.data("bDragCtx",{});if(D.draggable===true){if(h.isFunction(D.helper)){C=h(D.helper.call(w.get(0)))}else{if(D.helper==="original"){C=w}else{if(D.helper==="clone"){C=w.clone();C.attr("id",null);C.css("position","absolute");var I=w.offset();C.css({top:I.top,left:I.left});h("body").append(C)}}}}var F=g(A,w,C,k);w.trigger(k,[F])}}if(x){var G=g(J,w,C,o);var E;if(D.draggable===true){E=e(C,G);G.overElement=E}w.trigger(o,[G]);if(D.draggable===true){a(C,G);var K=l(w,C);d(b,J,w,E,K)}J.preventDefault();J.stopPropagation()}});y.bind(u.end+"."+v,function(G){if(x){var F=g(G,w,C,n);var H;var E;if(D.draggable===true){E=e(C,F);F.overElement=E}w.trigger(n,[F]);if(D.draggable===true){a(C,F);H=l(w,C);d(f,G,w,E,H);if(!C.is(w)){C.remove()}}w.data("bDragCtx",null);G.preventDefault();G.stopPropagation()}h(document).unbind(u.drag+"."+v);h(document).unbind(u.end+"."+v)})}};function a(q,p){var r=q.position();q.css({left:r.left+p.deltaPageX,top:r.top+p.deltaPageY})}function d(t,s,u,z,x){var v=h(z);var r=u.data("bDragCtx");var y=r.overElem;var w,q;if(typeof y==="undefined"){w=h.Event(s);w.target=z;w.type=c;v.trigger(w,x)}else{if(y!=z){q=h.Event(s);q.target=y;q.type=j;h(y).trigger(q,x);w=h.Event(s);w.target=z;w.type=c;v.trigger(w,x)}}r.overElem=z;var p=h.Event(s);p.target=z;p.type=t;v.trigger(p,x)}function e(r,q){r.hide();var p=document.elementFromPoint(q.pageX,q.pageY);r.show();return p}function g(t,q,v,s){brite.event.fixTouchEvent(t);var u=brite.ua.hasTouch();var p={eventSource:t,pageX:t.pageX,pageY:t.pageY};if(v){p.helperElement=v.get(0)}var w=t.originalEvent;if(u){p.touches=w.touches}var r=q.data("bDragCtx");if(s===k){r.startPageX=p.startPageX=p.pageX;r.startPageY=p.startPageY=p.pageY;r.lastPageX=r.startPageX=p.startPageX;r.lastPageY=r.startPageY=p.startPageY}else{if(s===n){p.pageX=r.lastPageX;p.pageY=r.lastPageY}}p.startPageX=r.startPageX;p.startPageY=r.startPageY;p.deltaPageX=p.pageX-r.lastPageX;p.deltaPageY=p.pageY-r.lastPageY;r.lastPageX=p.pageX;r.lastPageY=p.pageY;return p}function l(q,r){var p={};p.draggableElement=q.get(0);p.helperElement=r.get(0);return p}h.fn.bDrag.defaults={draggable:false,helper:"original",threshold:5}})(jQuery);